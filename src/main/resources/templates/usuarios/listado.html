<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>Lista de Proveedores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:href="@{/css/style.css}" rel="stylesheet">
</head>
<body class="body-formulario">

<div class="container-fluid mt-5" id="cont-form">
    <div class="card p-4 shadow-sm bg-white">

        <!-- üìù T√çTULO CENTRADO SOLO -->
        <div class="text-center mb-4">
            <h2 class="mb-0 fw-bold">üìù Lista de Proveedores</h2>
        </div>

        <!-- üîç BUSCADOR A LA IZQUIERDA - BOTONES A LA DERECHA -->
        <div class="d-flex justify-content-between align-items-center flex-wrap mb-4">

            <!-- FORMULARIO DE B√öSQUEDA -->
            <form th:action="@{/usuarios}" method="get" class="d-flex align-items-center gap-2 mb-2 mb-md-0">
                <input type="text" name="filtro" class="form-control form-control-sm"
                       placeholder="üîç Buscar proveedor..." th:value="${filtro}">
                <input type="hidden" name="pagina" value="0" />
                <button type="submit" class="btn btn-outline-secondary btn-sm">Buscar</button>
            </form>

            <!-- BOTONES NUEVO / CERRAR SESI√ìN -->
            <div class="d-flex gap-2" sec:authorize="isAuthenticated()">
                <a th:href="@{/usuarios/nuevo}" class="btn btn-success btn-sm">‚ûï Nuevo Proveedor</a>
                <a href="/logout" class="btn btn-outline-danger btn-sm">üîí Cerrar sesi√≥n</a>
            </div>
        </div>

        <!-- üìã TABLA DE USUARIOS / PROVEEDORES -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark" id="thead-listado">
                <tr>
                    <th>ID</th>
                    <th>Raz√≥n Social</th>
                    <th>Nit / CC</th>
                    <th>Nombre</th>
                    <th>Tel√©fono</th>
                    <th>Correo</th>
                    <th>Tipo de Servicio</th>
                    <th>Estado</th>
                    <th>Fecha Registro</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="usuario : ${usuarios}">
                    <td th:text="${usuario.id}"></td>
                    <td th:text="${usuario.razonSocial}"></td>
                    <td th:text="${usuario.nitCc}"></td>
                    <td th:text="${usuario.nombre}"></td>
                    <td th:text="${usuario.telefono}"></td>
                    <td th:text="${usuario.correo}"></td>
                    <td th:text="${usuario.tipoServicio}"></td>
                    <td th:text="${usuario.estado}"></td>
                    <td th:text="${usuario.fechaRegistro}"></td>
                    <td>
                        <a th:href="@{'/usuarios/editar/' + ${usuario.id}}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>
                        <a th:href="@{'/usuarios/eliminar/' + ${usuario.id}}"
                           class="btn btn-sm btn-danger"
                           onclick="return confirm('¬øDeseas eliminar este usuario?');">üóëÔ∏è</a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- üì§ EXPORTAR Y PAGINACI√ìN -->
        <div class="d-flex justify-content-between align-items-center mt-4 flex-wrap">

            <!-- BOTONES DE EXPORTACI√ìN (IZQUIERDA) -->
            <div class="d-flex gap-2 mb-2 mb-md-0">
                <a th:href="@{/usuarios/exportar-todos}"
                   onclick="mostrarMensaje('‚úÖ Exportaci√≥n de todos los usuarios iniciada')"
                   class="btn btn-secondary btn-sm">‚¨á Exportar Todos (CSV)</a>

                <a th:href="@{/usuarios/exportar-pagina(pagina=${paginaActual}, tamano=8)}"
                   onclick="mostrarMensaje('‚úÖ Exportando esta p√°gina de usuarios')"
                   class="btn btn-info btn-sm">üìÑ Exportar P√°gina Actual</a>
            </div>

            <!-- TEXTO Y BOTONES DE P√ÅGINA (DERECHA) -->
            <div class="d-flex align-items-center gap-3">

                <!-- TEXTO: P√°gina X de Y -->
                <div class="small">
                    P√°gina <span th:text="${paginaActual + 1}"></span> de <span th:text="${totalPaginas}"></span>
                </div>

                <!-- BOTONES DE P√ÅGINA -->
                <div class="d-flex gap-2">
                    <a th:if="${paginaActual > 0}"
                       th:href="@{'/usuarios'(pagina=${paginaActual - 1}, tamano=7)}"
                       class="btn btn-outline-primary btn-sm">‚¨Ö Anterior</a>

                    <a th:if="${paginaActual + 1 < totalPaginas}"
                       th:href="@{'/usuarios'(pagina=${paginaActual + 1}, tamano=7)}"
                       class="btn btn-outline-primary btn-sm">Siguiente ‚û°</a>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- SCRIPT: Notificaci√≥n simple -->
<script>
    function mostrarMensaje(mensaje) {
        alert(mensaje); // Se puede reemplazar con SweetAlert2 o Toast si prefieres
    }
</script>
</body>
</html>
